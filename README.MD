# Module 5 week 3-4

В учебных целях реализован проект на Django + Docker с механизмом регистрации и авторизации пользователей.
Ключевые используемые модули:
* Django
* django-allauth
* docker-volume-backup


Полный список зависимостей в файле requirements.txt

## Установка

1. Клонируйте репозиторий
2. Создайте .env файл в корне проекта, .env.sample являет собой образец готовой конфигурации для тестового запуска 
3. Частота бэкапов настраивается в docker-compose.yml в строке BACKUP_CRON_EXPRESSION: "*/1 * * * *" - по умолчанию раз в минуту
4. Бэкапы сохраняются в папку backups/ в корне проекта
5. `docker-compose up --build -d` - создает и запускает контейнеры с БД, приложением, + контейнер для созданий бэкапов

Удаление:
6. `docker-compose down -v` - останавливает и удаляет контейнеры, сети, тома и образы, созданные с помощью команды docker-compose up. С ключем -v вместе с созаднными volumes. **Использовать с осторожностью, если в системе уже присутствуют необходимые вам тома, созданные аналогичным образом. В этом случае удать избирательно.**

## Использование
* Роут /accounts/ предоставляет доступ к регистрации и создания пользователей
* Управление уровнями доступа осуществляется через Django-admin на /admin/
* Для управлением правами пользователей (пользователь-администратор) создайте суперпользователя-администратора `python manage.py createsuperuser`

### Авторизация через Google OAuth:
* В админке необходимо изменить хост в разделе Sites c example.com на актуальный
* Затем в Social applications добавить подключение Google с https://console.cloud.google.com/ - API&Services - Credentials


Восстановление из бэкапа:
* Остановить контейнер с БД и дождаться полной остановки
* docker run --rm -it -v module5_week3_pg_data:/backup/my-app-backup -v <абсолютный путь до папки с архивом>:/archive:ro alpine tar -xvzf archive/<имя файла с бэкапом>
* Вместо module5_week3 подставить ваше имя папки проекта для полного соответствия с именем контейнера
* Запустить контейнер с БД